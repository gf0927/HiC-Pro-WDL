azure {
  application-name = "cromwell"
  auths = [
    {
      name = "account-key"
      scheme = "client_secret_credential"
      account-name = "seqslabapi97e51storage"
      client-id = "db0a834a-c971-4646-9d0c-000145d44b1d"
      client-secret = "rdM_D~-tXEdjPYE55N68CMt-yAmf0cvtZ3"
      tenant = "fa19c033-a7ff-48c5-95e7-61d1ed2ea984"
      subscription = "97e5113a-3007-4785-84d7-87f5302510a3"
    },
    {
      name = "batchaccount-key"
      scheme = "client_secret_credential"
      account-name = "seqslabapi97e51batch"
      client-id = "db0a834a-c971-4646-9d0c-000145d44b1d"
      client-secret = "rdM_D~-tXEdjPYE55N68CMt-yAmf0cvtZ3"
      tenant = "fa19c033-a7ff-48c5-95e7-61d1ed2ea984"
      subscription = "97e5113a-3007-4785-84d7-87f5302510a3"
    },
    {
      name = "api-token1"
      scheme = "api_token_credential"
      access-token = ""
      refresh-token = ""
      endpoint = "https://api.seqslab.net/wes/v1/service-info/workspaces/atgxtestws/resources/"
    }
  ]
}

engine {
  filesystems {
    abfss {
      auth = "account-key"
      AzureStorageHttpLogDetailLevel = "BASIC"
      // AzureStorageMaxTries = 10
      // AzureStorageTryTimeout = ""
      // AzureStorageRetryDelayInMs = ""
      // AzureStorageMaxRetryDelayInMs = ""
      // AzureStorageRetryPolicyType = ""
      // AzureSTorageSecondaryHost = ""
      AzureStorageUploadBlockSize = 512
      AzureStorageMaxConcurrencyPerRequest = 20
      AzureStoragePutBlobThreshold = 10
      AzureStorageDownloadResumeRetries = 10
      AzureStorageUseHttps = true
      AzureStorageFileSystems = "yuting"
    }
  }
}

seqslab {
  // Run Id
  run-id = "run_aaaaaaaaaa"
  run-name = "HiC-Pro-test-001"

  // Redis Cache
  redis = "redis://:3Y5ce21ZeM1KzKn9BIwlCWErtab9vk2+qiSoVPUkJRE=@nckuredis.redis.cache.windows.net:6379/0"

  // Use When Triggered from client-Id + Secret-Id (No need when you triggered from Seqslab-API)
  // Workspace
  workspace = "/subscriptions/97e5113a-3007-4785-84d7-87f5302510a3/resourceGroups/seqslabapi"

  // Docker Related Information
  docker_username = "1672a662-f053-438f-93db-8462acd0b202"
  docker_password = "37fea490-af96-40f5-a611-26e78c32ce85"
  docker_endpoint = "atgenomix.azurecr.io"

  // Aztk Mount Path
  aztk_path = "/datadrive/atgenomix/aztk"
  mount_path = "/datadrive/atgenomix/aztk/mount.sh"


  // User Id
  user-id = "usr_Z6rlitZqIJQxPAX"
  cus-id = ""

  debug-mode = "true"
}


backend {
  default = "azure"
  providers {
    azure {
      actor-factory = "cromwell.backend.atgenomix.seqslab.azurebatch.AzureBatchBackendLifecycleActorFactory"
      config {
        auth = "account-key"

        default-runtime-attributes {
          cpu: 1
          memory: "2048 MB"
        }

        filesystems {
          abfss {
            auth {
              auth = "account-key"
            }
          }
        }
      }
    }
  }
}

services {
  SeqslabLog {
    class = "cromwell.services.seqslablog.impl.SeqslabLogServiceInCromwellActor"
    config {
      log-path: "/var/log/seqslab"
    }
  }
  RedisLog {
    class = "cromwell.services.redislog.impl.RedisLogServiceInCromwellActor"
  }
  AzureBatch {
    class = "cromwell.services.azurebatch.impl.AzureBatchServiceInCromwellActor"
  }
  ClusterManager {
    class = "cromwell.services.clustermanager.impl.ClusterManagerServiceInCromwellActor"
  }
}

input_mapping {
  lookuptable: [
    {
      "fqn": "Hic_Docker.inputSamples",
      "local": [["/datadrive/input_files/fastq/test_data/dixon_2M/SRR400264_00_R1.fastq.gz", "/datadrive/input_files/fastq/test_data/dixon_2M/SRR400264_00_R2.fastq.gz"],["/datadrive/input_files/fastq/test_data/dixon_2M_2/SRR400264_01_R1.fastq.gz",	"/datadrive/input_files/fastq/test_data/dixon_2M_2/SRR400264_01_R2.fastq.gz"]],
      "cloud": [
        [
          {
            "id": "drs_xxxxxxxxxxxxxxx",
            "created_time": "2021-10-30T01:45:31.004766Z",
            "checksums": [],
            "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
            "size": 238196,
            "access_methods": [
              {
                "type": "abfss",
                "region": "westus2",
                "access_tier": "hot",
                "access_id": "11",
                "access_url": {
                  "headers": {},
                  "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M/SRR400264_00_R1.fastq.gz"
                }
              }
            ]
          },
          {
            "id": "drs_xxxxxxxxxxxxxxx",
            "created_time": "2021-10-30T01:45:31.004766Z",
            "checksums": [],
            "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
            "size": 238196,
            "access_methods": [
              {
                "type": "abfss",
                "region": "westus2",
                "access_tier": "hot",
                "access_id": "11",
                "access_url": {
                  "headers": {},
                  "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M/SRR400264_00_R2.fastq.gz"
                }
              }
            ]
          }
        ],
        [
          {
            "id": "drs_xxxxxxxxxxxxxxx",
            "created_time": "2021-10-30T01:45:31.004766Z",
            "checksums": [],
            "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
            "size": 238196,
            "access_methods": [
              {
                "type": "abfss",
                "region": "westus2",
                "access_tier": "hot",
                "access_id": "11",
                "access_url": {
                  "headers": {},
                  "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M_2/SRR400264_01_R1.fastq.gz"
                }
              }
            ]
          },
          {
            "id": "drs_xxxxxxxxxxxxxxx",
            "created_time": "2021-10-30T01:45:31.004766Z",
            "checksums": [],
            "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
            "size": 238196,
            "access_methods": [
              {
                "type": "abfss",
                "region": "westus2",
                "access_tier": "hot",
                "access_id": "11",
                "access_url": {
                  "headers": {},
                  "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M_2/SRR400264_01_R2.fastq.gz"
                }
              }
            ]
          }
        ]
      ]
    },
    {
      "fqn": "Hic_Docker.bedFile",
      "local": ["/HindIII_resfrag_hg19.bed"],
      "cloud": [
        {
          "id": "drs_xxxxxxxxxxxxxxx",
          "created_time": "2021-10-30T01:45:31.004766Z",
          "checksums": [],
          "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
          "size": 238196,
          "access_methods": [
            {
              "type": "abfss",
              "region": "westus2",
              "access_tier": "hot",
              "access_id": "11",
              "access_url": {
                "headers": {},
                "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/annotation/HindIII_resfrag_hg19.bed"
              }
            }
          ]
        }
      ]
    },
    {
      "fqn": "Hic_Docker.bowtieIndexPath",
      "local": ["data/btw2idx/hg19/"],
      "cloud": [
        {
          "id": "drs_xxxxxxxxxxxxxxx",
          "created_time": "2021-10-30T01:45:31.004766Z",
          "checksums": [],
          "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
          "size": 238196,
          "access_methods": [
            {
              "type": "abfss",
              "region": "westus2",
              "access_tier": "hot",
              "access_id": "11",
              "access_url": {
                "headers": {},
                "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/"
              }
            }
          ]
        }
      ]
    },
    {
      "fqn": "Hic_Docker.tableFile",
      "local": ["/chrom_hg19.sizes"],
      "cloud": [
        {
          "id": "drs_xxxxxxxxxxxxxxx",
          "created_time": "2021-10-30T01:45:31.004766Z",
          "checksums": [],
          "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
          "size": 238196,
          "access_methods": [
            {
              "type": "abfss",
              "region": "westus2",
              "access_tier": "hot",
              "access_id": "11",
              "access_url": {
                "headers": {},
                "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/input_files/annotation/chrom_hg19.sizes"
              }
            }
          ]
        }
      ]
    },
    {
      "fqn": "Hic_Docker.fakeFile",
      "local": ["test"],
      "cloud": [
        {
          "id": "drs_xxxxxxxxxxxxxxx",
          "created_time": "2021-10-30T01:45:31.004766Z",
          "checksums": [],
          "self_uri": "drs://seqslabapi-dev.azurewebsites.net/drs_xxxxxxxxxxxxxxx/",
          "size": 238196,
          "access_methods": [
            {
              "type": "abfss",
              "region": "westus2",
              "access_tier": "hot",
              "access_id": "11",
              "access_url": {
                "headers": {},
                "url": "abfss://yuting@seqslabapi97e51storage.dfs.core.windows.net/hic-wdl-example/README"
              }
            }
          ]
        }
      ]
    },
    {
      "fqn": "Hic_Docker.Bowtie_Global_Mapping.sampleR1",
      "operators": {
        "source": {
         "class": "com.atgenomix.seqslab.piper.operators.FastqSource",
          "codec": "org.seqdoop.hadoop_bam.util.BGZFEnhancedGzipCodec",
          "auth": ""
        },
        "partition": {
          "class": "com.atgenomix.seqslab.piper.operators.FastqPartition",
          "parallelism": "5000"
        },
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.FastqFormat",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "input": [
          "source",
          "partition",
          "format"
        ],
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Bowtie_Global_Mapping.sampleR2",
      "operators": {
        "source": {
          "class": "com.atgenomix.seqslab.piper.operators.FastqSource",
          "codec": "org.seqdoop.hadoop_bam.util.BGZFEnhancedGzipCodec",
          "auth": ""
        },
        "partition": {
          "class": "com.atgenomix.seqslab.piper.operators.FastqPartition",
          "parallelism": "5000"
        },
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.FastqFormat",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "input": [
          "source",
          "partition",
          "format"
        ],
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Bowtie_Global_Mapping.bowtieIndexPath",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Bowtie_Local_Mapping.bowtieIndexPath",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Build_Matrix.tableFile"
      "operators": {
        "format": {
          "auth": ""
          "class":"com.atgenomix.seqslab.piper.operators.RegularFile"
        },
        "p_pipe": {
          "class":"com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines":{
        "call":[
        "format"
        "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Mapped_Hic_Fragments.bedFile",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Merge_Valid_Interaction.validPairs",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Making_Plot.mappingStatR1",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Making_Plot.mappingStatR2",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Making_Plot.pairStat",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Making_Plot.rsStat",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "Hic_Docker.Making_Plot.mergeStat",
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    }
  ]
}

"runtimes": {
  "graph": "digraph content",
  "workspace": "atgxdev",
  "clusters": [
    {
      "name": "__main__",
      "id": "SeqsLab.Accelerate.GC1",
      "description": "Standard cluster with 256GB, 16 cores... (Runtime 2.0 Spark 3.3, Python 3.8, Java 1.8.0, Cromwell 57))",
      "settings": {
        "type": "batch.core.windows.net",
        "vm_size": "Standard_D13_v2",
        "workers": {
          "dedicated": 1,
          "spot": 0,
        },
        "worker_on_master": true,
        "auto_scale": false,
      },
      "options": [
        "spark.driver.cores 1",
        "spark.driver.memory 6g",
        "spark.executor.cores 1",
        "spark.executor.memory 7g",
        "spark.executor.instances 20",
        "spark.kryo.registrator org.bdgenomics.adam.serialization.ADAMKryoRegistrator",
        "spark.dynamicAllocation.enabled true",
        "spark.shuffle.service.enabled true",
        "spark.dynamicAllocation.minExecutors 1",
        "spark.local.dir /mnt"
      ],
      "slcu": "test"
    }
  ]
}

"trs": {
  "name": "test",
  "description": "est",
  "images": [
    {
      "name": "__main__"
      "image": "atgenomix.azurecr.io/atgenomix/seqslab_runtime-1.4_ubuntu-18.04_hicpro:2021-11-08-08-00"
    }
  ]
}
