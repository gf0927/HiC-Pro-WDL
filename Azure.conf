azure {
  application-name = "cromwell"
  auths = [
    {
      name = "account-key1"
      scheme = "client_secret_credential"
      account-name = "atgxtestws62fccstorage"
      client-id = ""
      client-secret = ""
      tenant = ""
      subscription = ""
    },
    {
      name = "batchaccount-key1"
      scheme = "client_secret_credential"
      account-name = "atgxtestws62fccbatch"
      client-id = ""
      client-secret = ""
      tenant = ""
      subscription = ""
    },
    {
      name = "api-token"
      scheme = "api_token_credential"
      access-token = ""
      refresh-token = ""
      endpoint = "https://api.seqslab.net/wes/v1/service-info/workspaces/atgxtestws/resources/"
    }
  ]
}

engine {
  filesystems {
    adls-gen2 {
      auth = "account-key"
      AzureStorageHttpLogDetailLevel = "BASIC"
      // AzureStorageMaxTries = 10
      // AzureStorageTryTimeout = ""
      // AzureStorageRetryDelayInMs = ""
      // AzureStorageMaxRetryDelayInMs = ""
      // AzureStorageRetryPolicyType = ""
      // AzureSTorageSecondaryHost = ""
      AzureStorageUploadBlockSize = 512
      AzureStorageMaxConcurrencyPerRequest = 20
      AzureStoragePutBlobThreshold = 10
      AzureStorageDownloadResumeRetries = 10
      AzureStorageUseHttps = true
      AzureStorageFileSystems = "yuting"
    }
  }
}

seqslab {
  // Run Id
  run-id = "00000000-0000-9213-8888-555111111111"

  // Redis Cache
  redis = "redis://:p8rZGiwHH3TxklknrbpXdRuR7NuD5bv5TYtrdyZ+4qA=@atgxredis.redis.cache.windows.net:6379/0"

  // Use When Triggered from client-Id + Secret-Id (No need when you triggered from Seqslab-API)
  // Workspace 
  workspace = "/subscriptions/62fccd52-f6fe-4f3b-aa3a-bfe2b4ae0bbc/resourceGroups/atgxtestws"

  // Docker Related Information
  docker_username = ""
  docker_password = ""
  docker_endpoint = "atgenomix.azurecr.io"

  // Aztk Mount Path
  aztk_path = "/Users/linyuting/Atgenomix/pipenv_aztk/aztk"
  mount_path = "/Users/linyuting/Atgenomix/cromwell-files/mount.sh"

  // User Id
  user-id = "usr_Z6rlitZqIJQxPAX"
}


backend {
  default = "AzureBatch"
  providers {
    AzureBatch {
      actor-factory = "cromwell.backend.atgenomix.seqslab.azurebatch.AzureBatchBackendLifecycleActorFactory"
      config {
        auth = "account-key"

        default-runtime-attributes {
          cpu: 1
          memory: "2048 MB"
        }

        filesystems {
          adls-gen2 {
            auth {
              auth = "account-key"
            }
          }
        }
      }
    }
  }
}


input-mapping {
  lookuptable: [
    {
      "fqn": "hic_docker.Sample_r1",
      "local": ["SRR400264_00_R1.fastq"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.GenericFormat",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M/SRR400264_00_R1.fastq.gz"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Sample_r2",
      "local": ["SRR400264_00_R2.fastq"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.GenericFormat",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/fastq/test_data/dixon_2M/SRR400264_00_R2.fastq.gz"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.BED_FILE",
      "local": ["/HindIII_resfrag_hg19.bed"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/annotation/HindIII_resfrag_hg19.bed"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_1",
      "local": ["/tmp/hg19.1.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.1.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_2",
      "local": ["/tmp/hg19.2.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.2.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_3",
      "local": ["/tmp/hg19.4.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.4.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_4",
      "local": ["/tmp/hg19.4.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.4.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_re1",
      "local": ["/tmp/hg19.rev.1.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.rev.1.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_idx_re2",
      "local": ["/tmp/hg19.rev.2.bt2"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/hg19.rev.2.bt2"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.Bowtie_makesh",
      "local": ["/tmp/make_hg19.sh"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularFile",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19/make_hg19.sh"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    },
    {
      "fqn": "hic_docker.bowtie_idx_path",
      "local": ["/hg19"],
      "operators": {
        "format": {
          "class": "com.atgenomix.seqslab.piper.operators.RegularDir",
          "url": ["abfss://yuting@atgxtestws62fccstorage.dfs.core.windows.net/hic-wdl-example/input_files/btw2idx/hg19"],
          "auth": ""
        },
        "p_pipe": {
          "class": "com.atgenomix.seqslab.piper.operators.PPipe"
        }
      },
      "pipelines": {
        "call": [
          "format",
          "p_pipe"
        ]
      }
    }
  ]
}

"runtimes": {
  "graph": "digraph content",
  "workspace": "atgxdev",
  "clusters": [
    {
      "name": "__main__",    
      "id": "SeqsLab.Accelerate.GC1",     
      "description": "Standard cluster with 256GB, 16 cores... (Runtime 2.0 Spark 3.3, Python 3.8, Java 1.8.0, Cromwell 57))", 
      "settings": {
        "type": "batch.core.windows.net",
        "vm_size": "Standard_D13_v2",
        "workers": {
          "dedicated": 0,
          "spot": 1,
        },
        "worker_on_master": true,
        "auto_scale": false,
      },
      "options": [
        "spark.driver.cores 1",
        "spark.driver.memory 6g",
        "spark.executor.cores 1",
        "spark.executor.memory 7g",
        "spark.executor.instances 20",
        "spark.kryo.registrator org.bdgenomics.adam.serialization.ADAMKryoRegistrator",
        "spark.dynamicAllocation.enabled true",
        "spark.shuffle.service.enabled true",
        "spark.dynamicAllocation.minExecutors 1",
        "spark.local.dir /mnt"
      ],
      "slcu": "test"
    }
  ]
}

"trs": {
  "name": "test",
  "description": "est",
  "images": [
    {
      "name": "__main__"
      "image": "atgenomix.azurecr.io/atgenomix/seqslab_runtime-1.4_ubuntu-18.04_hicpro:2021-07-21-07-43"
    }
  ]
}
